
// æ¯æ—¥æ¨é€æ•°æ®åº“
const dailyContents = {
    "2026-02-10": {
        phrase: "Break a leg!",
        phonetic: "/breÉªk É™ leÉ¡/",
        translation: "ç¥ä½ å¥½è¿ï¼ï¼ˆæ¼”å‡º/è¡¨æ¼”å‰å¸¸ç”¨ï¼‰",
        category: "ç¤¾äº¤äº’åŠ¨",
        scene: "ç”¨äºæˆå‰§ã€æ¼”å‡ºã€æ¼”è®²ã€é¢è¯•ç­‰åœºåˆå‰ç¥ç¦ä»–äººã€‚åƒä¸‡ä¸è¦æŒ‰å­—é¢ç†è§£æˆ'æ‘”æ–­è…¿'ï¼",
        examples: [
            { en: "Good luck on your presentation tonight. Break a leg!", cn: "ç¥ä½ ä»Šæ™šæ¼”è®²é¡ºåˆ©ï¼ŒåŠ æ²¹ï¼" },
            { en: "Break a leg at your audition tomorrow!", cn: "ç¥ä½ æ˜å¤©è¯•é•œæˆåŠŸï¼" }
        ],
        keywords: [
            { word: "break", phonetic: "/breÉªk/", meaning: "v. æ‰“ç ´ï¼ŒæŠ˜æ–­" },
            { word: "leg", phonetic: "/leÉ¡/", meaning: "n. è…¿" }
        ],
        explanation: "è¿™ä¸ªçŸ­è¯­çš„èµ·æºæœ‰å‡ ç§è¯´æ³•ï¼Œæœ€æµè¡Œçš„æ˜¯å‰§é™¢è¿·ä¿¡ï¼šç›´æ¥è¯´'good luck'åè€Œä¼šå¸¦æ¥å„è¿ï¼Œæ‰€ä»¥è¯´åè¯'break a leg'åè€Œèƒ½ç¥å¯¹æ–¹å¥½è¿ã€‚å¦ä¸€ä¸ªè¯´æ³•æ˜¯è§‚ä¼—é¼“æŒå¤ªçƒ­çƒˆï¼Œè†ç›–å¼¯æ›²åƒè¦'break'äº†è…¿ä¸€æ ·ã€‚"
    },
    "2026-02-11": {
        phrase: "I'm running late.",
        phonetic: "/aÉªm ËˆrÊŒnÉªÅ‹ leÉªt/",
        translation: "æˆ‘è¦è¿Ÿåˆ°äº† / æˆ‘å¿«èµ¶ä¸ä¸Šäº†",
        category: "æ—¥å¸¸ç”¨è¯­",
        scene: "éå¸¸å®ç”¨çš„æ—¥å¸¸è¡¨è¾¾ï¼Œç”¨äºå‘ŠçŸ¥ä»–äººè‡ªå·±å¯èƒ½ä¼šæ™šåˆ°ã€‚é€‚ç”¨äºä¸Šç­ã€çº¦ä¼šã€ä¼šè®®ã€èšä¼šç­‰å„ç§åœºåˆã€‚æ¯”ç®€å•çš„'I'm late'æ›´åœ°é“ï¼Œè¡¨ç¤º'æ­£åœ¨èµ¶ä½†å¯èƒ½è¦è¿Ÿåˆ°'ã€‚",
        examples: [
            { en: "Sorry, I'm running late. Traffic is terrible today.", cn: "æŠ±æ­‰ï¼Œæˆ‘è¦è¿Ÿåˆ°äº†ã€‚ä»Šå¤©äº¤é€šå¤ªç³Ÿç³•äº†ã€‚" },
            { en: "Can we start the meeting in 10 minutes? I'm running late.", cn: "æˆ‘ä»¬èƒ½10åˆ†é’Ÿåå†å¼€å§‹ä¼šè®®å—ï¼Ÿæˆ‘è¦è¿Ÿåˆ°äº†ã€‚" }
        ],
        keywords: [
            { word: "running", phonetic: "/ËˆrÊŒnÉªÅ‹/", meaning: "adj. åœ¨è¿›è¡Œä¸­çš„ï¼Œè¿ç»­çš„" },
            { word: "late", phonetic: "/leÉªt/", meaning: "adj. è¿Ÿçš„ï¼Œæ™šçš„" }
        ],
        explanation: "'Run late'æ˜¯è‹±è¯­ä¸­éå¸¸åœ°é“çš„è¡¨è¾¾ï¼Œå­—é¢æ„æ€æ˜¯'æ—¶é—´åœ¨è·‘ç€æµé€'ï¼Œå®é™…è¡¨ç¤º'è¦è¿Ÿåˆ°äº†'ã€‚ç±»ä¼¼è¡¨è¾¾è¿˜æœ‰'running behind schedule'ï¼ˆè½åäºæ—¥ç¨‹ï¼‰ã€‚è®°ä½'running'åœ¨è¿™é‡Œä¸æ˜¯'è·‘æ­¥'çš„æ„æ€ï¼"
    },
    "2026-02-09": {
        phrase: "I couldn't agree more.",
        phonetic: "/aÉª ËˆkÊŠdnt É™ËˆÉ¡riË mÉ”Ër/",
        translation: "æˆ‘å†åŒæ„ä¸è¿‡äº† / æˆ‘å®Œå…¨åŒæ„",
        category: "æ—¥å¸¸ç”¨è¯­",
        scene: "ç”¨äºå¼ºçƒˆè¡¨ç¤ºèµåŒå¯¹æ–¹çš„è§‚ç‚¹ã€‚æ¯”ç®€å•çš„'I agree'æ›´æœ‰åŠ›åº¦ï¼Œè¡¨è¾¾ç™¾åˆ†ä¹‹ç™¾çš„è®¤åŒã€‚",
        examples: [
            { en: "A: This pizza is amazing! B: I couldn't agree more!", cn: "A: è¿™ä¸ªæŠ«è¨å¤ªå¥½åƒäº†ï¼B: å®Œå…¨åŒæ„ï¼" },
            { en: "I couldn't agree more with your suggestion.", cn: "æˆ‘å®Œå…¨åŒæ„ä½ çš„å»ºè®®ã€‚" }
        ],
        keywords: [
            { word: "agree", phonetic: "/É™ËˆÉ¡riË/", meaning: "v. åŒæ„" },
            { word: "more", phonetic: "/mÉ”Ër/", meaning: "adv. æ›´ï¼Œæ›´å¤š" }
        ],
        explanation: "è¿™æ˜¯ä¸€ä¸ªåŒé‡å¦å®šè¡¨ç¤ºå¼ºè°ƒçš„å¥å¼ã€‚å­—é¢æ„æ€æ˜¯'æˆ‘ä¸èƒ½åŒæ„æ›´å¤šäº†'ï¼Œå®é™…æ„æ€æ˜¯'æˆ‘å·²ç»åŒæ„åˆ°æè‡´äº†'ï¼Œæ˜¯éå¸¸åœ°é“çš„è‹±è¯­è¡¨è¾¾æ–¹å¼ã€‚"
    }
};

// çŸ­è¯­æ•°æ®åº“
const phrases = {
    daily: [
        { en: "Hello, how are you?", cn: "ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ" },
        { en: "Nice to meet you.", cn: "å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚" },
        { en: "Thank you very much.", cn: "éå¸¸æ„Ÿè°¢ã€‚" },
        { en: "You're welcome.", cn: "ä¸å®¢æ°”ã€‚" },
        { en: "Excuse me.", cn: "æ‰“æ‰°ä¸€ä¸‹ / å€Ÿè¿‡ã€‚" },
        { en: "I'm sorry.", cn: "å¯¹ä¸èµ·ã€‚" },
        { en: "No problem.", cn: "æ²¡é—®é¢˜ã€‚" },
        { en: "Have a good day!", cn: "ç¥ä½ ä»Šå¤©æ„‰å¿«ï¼" },
        { en: "See you later.", cn: "å›å¤´è§ã€‚" },
        { en: "Good morning!", cn: "æ—©ä¸Šå¥½ï¼" },
        { en: "Good night!", cn: "æ™šå®‰ï¼" },
        { en: "How's it going?", cn: "æœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ" },
        { en: "Long time no see.", cn: "å¥½ä¹…ä¸è§ã€‚" },
        { en: "Take care.", cn: "ä¿é‡ã€‚" },
        { en: "I don't understand.", cn: "æˆ‘ä¸æ˜ç™½ã€‚" },
        { en: "Could you repeat that?", cn: "ä½ èƒ½å†è¯´ä¸€éå—ï¼Ÿ" },
        { en: "What do you think?", cn: "ä½ æ€ä¹ˆçœ‹ï¼Ÿ" },
        { en: "That sounds great!", cn: "å¬èµ·æ¥å¾ˆæ£’ï¼" },
        { en: "I'm not sure.", cn: "æˆ‘ä¸ç¡®å®šã€‚" },
        { en: "Let me think about it.", cn: "è®©æˆ‘æƒ³æƒ³ã€‚" }
    ],
    business: [
        { en: "Let's schedule a meeting.", cn: "æˆ‘ä»¬å®‰æ’ä¸ªä¼šè®®å§ã€‚" },
        { en: "I'll get back to you soon.", cn: "æˆ‘å¾ˆå¿«å›å¤ä½ ã€‚" },
        { en: "Can we discuss this?", cn: "æˆ‘ä»¬èƒ½è®¨è®ºä¸€ä¸‹è¿™ä¸ªå—ï¼Ÿ" },
        { en: "What's the deadline?", cn: "æˆªæ­¢æ—¥æœŸæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ" },
        { en: "I'll handle it.", cn: "æˆ‘æ¥å¤„ç†ã€‚" },
        { en: "Let's touch base next week.", cn: "æˆ‘ä»¬ä¸‹å‘¨è”ç³»ä¸€ä¸‹ã€‚" },
        { en: "I'm tied up right now.", cn: "æˆ‘ç°åœ¨å¾ˆå¿™ã€‚" },
        { en: "Could you clarify that?", cn: "ä½ èƒ½è§£é‡Šä¸€ä¸‹å—ï¼Ÿ" },
        { en: "Let's move forward with this.", cn: "æˆ‘ä»¬ç»§ç»­æ¨è¿›è¿™ä¸ªå§ã€‚" },
        { en: "I need your input on this.", cn: "æˆ‘éœ€è¦ä½ åœ¨è¿™ä¸ªä¸Šçš„æ„è§ã€‚" },
        { en: "The bottom line is...", cn: "åº•çº¿æ˜¯..." },
        { en: "Let's think outside the box.", cn: "æˆ‘ä»¬è¦è·³å‡ºæ€ç»´å®šå¼ã€‚" },
        { en: "Can you give me a ballpark figure?", cn: "èƒ½ç»™æˆ‘ä¸€ä¸ªå¤§æ¦‚æ•°å­—å—ï¼Ÿ" },
        { en: "We need to streamline this process.", cn: "æˆ‘ä»¬éœ€è¦ç®€åŒ–è¿™ä¸ªæµç¨‹ã€‚" },
        { en: "Let's circle back to this.", cn: "æˆ‘ä»¬ç¨åå†å›åˆ°è¿™ä¸ªè¯é¢˜ã€‚" }
    ],
    travel: [
        { en: "Where is the bathroom?", cn: "æ´—æ‰‹é—´åœ¨å“ªé‡Œï¼Ÿ" },
        { en: "How much does this cost?", cn: "è¿™ä¸ªå¤šå°‘é’±ï¼Ÿ" },
        { en: "I'd like to check in.", cn: "æˆ‘æƒ³åŠç†å…¥ä½ã€‚" },
        { en: "Can I get the menu, please?", cn: "èƒ½ç»™æˆ‘èœå•å—ï¼Ÿ" },
        { en: "Is there Wi-Fi here?", cn: "è¿™é‡Œæœ‰Wi-Fiå—ï¼Ÿ" },
        { en: "What time does it open?", cn: "å‡ ç‚¹å¼€é—¨ï¼Ÿ" },
        { en: "I'd like a table for two.", cn: "æˆ‘æƒ³è¦ä¸€å¼ ä¸¤äººæ¡Œã€‚" },
        { en: "Can you recommend a good restaurant?", cn: "ä½ èƒ½æ¨èä¸€å®¶å¥½é¤å…å—ï¼Ÿ" },
        { en: "How do I get to...?", cn: "æˆ‘æ€ä¹ˆå»...ï¼Ÿ" },
        { en: "I'd like to book a room.", cn: "æˆ‘æƒ³é¢„è®¢ä¸€ä¸ªæˆ¿é—´ã€‚" },
        { en: "Is breakfast included?", cn: "åŒ…å«æ—©é¤å—ï¼Ÿ" },
        { en: "Can I have the bill, please?", cn: "èƒ½ç»™æˆ‘è´¦å•å—ï¼Ÿ" },
        { en: "Do you accept credit cards?", cn: "ä½ ä»¬æ”¶ä¿¡ç”¨å¡å—ï¼Ÿ" },
        { en: "I'm looking for...", cn: "æˆ‘åœ¨æ‰¾..." },
        { en: "It's too expensive.", cn: "å¤ªè´µäº†ã€‚" }
    ],
    social: [
        { en: "What do you do for fun?", cn: "ä½ å¹³æ—¶å–œæ¬¢åšä»€ä¹ˆï¼Ÿ" },
        { en: "Tell me about yourself.", cn: "è·Ÿæˆ‘è¯´è¯´ä½ è‡ªå·±ã€‚" },
        { en: "We should hang out sometime.", cn: "æˆ‘ä»¬åº”è¯¥æ‰¾ä¸ªæ—¶é—´å‡ºå»ç©ã€‚" },
        { en: "I'm having a party this weekend.", cn: "æˆ‘è¿™å‘¨æœ«æœ‰ä¸ªæ´¾å¯¹ã€‚" },
        { en: "Do you want to grab coffee?", cn: "ä½ æƒ³å»å–æ¯å’–å•¡å—ï¼Ÿ" },
        { en: "What's new with you?", cn: "ä½ æœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ" },
        { en: "Keep in touch!", cn: "ä¿æŒè”ç³»ï¼" },
        { en: "I'm just kidding.", cn: "æˆ‘å¼€ç©ç¬‘çš„ã€‚" },
        { en: "You crack me up!", cn: "ä½ å¤ªé€—äº†ï¼" },
        { en: "That's hilarious!", cn: "å¤ªå¥½ç¬‘äº†ï¼" },
        { en: "I'm down for whatever.", cn: "æˆ‘ä»€ä¹ˆéƒ½è¡Œã€‚" },
        { en: "Let's split the bill.", cn: "æˆ‘ä»¬AAå§ã€‚" },
        { en: "It's my treat.", cn: "æˆ‘è¯·å®¢ã€‚" },
        { en: "Cheers!", cn: "å¹²æ¯ï¼" },
        { en: "Bottoms up!", cn: "ä¸€é¥®è€Œå°½ï¼" }
    ],
    emergency: [
        { en: "Help!", cn: "æ•‘å‘½ï¼" },
        { en: "Call the police!", cn: "æŠ¥è­¦ï¼" },
        { en: "I need a doctor.", cn: "æˆ‘éœ€è¦åŒ»ç”Ÿã€‚" },
        { en: "Where is the hospital?", cn: "åŒ»é™¢åœ¨å“ªé‡Œï¼Ÿ" },
        { en: "I've lost my passport.", cn: "æˆ‘çš„æŠ¤ç…§ä¸¢äº†ã€‚" },
        { en: "I'm allergic to...", cn: "æˆ‘å¯¹...è¿‡æ•ã€‚" },
        { en: "It's an emergency!", cn: "è¿™æ˜¯ç´§æ€¥æƒ…å†µï¼" },
        { en: "Can you help me?", cn: "ä½ èƒ½å¸®æˆ‘å—ï¼Ÿ" },
        { en: "I don't feel well.", cn: "æˆ‘ä¸èˆ’æœã€‚" },
        { en: "Where is the nearest pharmacy?", cn: "æœ€è¿‘çš„è¯åº—åœ¨å“ªé‡Œï¼Ÿ" },
        { en: "My phone was stolen.", cn: "æˆ‘çš„æ‰‹æœºè¢«å·äº†ã€‚" },
        { en: "I need to contact my embassy.", cn: "æˆ‘éœ€è¦è”ç³»æˆ‘çš„å¤§ä½¿é¦†ã€‚" },
        { en: "I've been in an accident.", cn: "æˆ‘å‡ºäº‹æ•…äº†ã€‚" },
        { en: "Is there a doctor here?", cn: "è¿™é‡Œæœ‰åŒ»ç”Ÿå—ï¼Ÿ" },
        { en: "Please hurry!", cn: "è¯·å¿«ç‚¹ï¼" }
    ]
};

// çŠ¶æ€ç®¡ç†
let currentCategory = 'daily';
let currentIndex = 0;
let learnedPhrases = JSON.parse(localStorage.getItem('learnedPhrases') || '[]');
let quizStats = JSON.parse(localStorage.getItem('quizStats') || '{"total": 0, "correct": 0}');
let currentCalendarDate = new Date();

// åˆå§‹åŒ–
function init() {
    loadTodayContent();
    initCalendar();
    loadCategory();
    loadPhraseList();
    updateStats();
}

// è·å–ä»Šå¤©çš„æ—¥æœŸå­—ç¬¦ä¸² YYYY-MM-DD
function getTodayString() {
    const today = new Date();
    return today.toISOString().split('T')[0];
}

// æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
function formatDate(date) {
    const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    const weekday = weekdays[date.getDay()];
    return `${year}å¹´${month}æœˆ${day}æ—¥ ${weekday}`;
}

// åŠ è½½ä»Šæ—¥å†…å®¹
function loadTodayContent() {
    const today = new Date();
    const dateStr = getTodayString();
    const content = dailyContents[dateStr];
    
    document.getElementById('today-date').textContent = formatDate(today);
    
    if (content) {
        document.getElementById('today-content').innerHTML = generateTodayHTML(content);
    } else {
        // å¦‚æœæ²¡æœ‰ä»Šæ—¥å†…å®¹ï¼Œæ˜¾ç¤ºç¤ºä¾‹æˆ–æç¤º
        const exampleContent = dailyContents["2026-02-11"];
        document.getElementById('today-content').innerHTML = generateTodayHTML(exampleContent);
    }
}

// ç”Ÿæˆä»Šæ—¥å†…å®¹HTML
function generateTodayHTML(content) {
    let examplesHTML = content.examples.map(ex => 
        `<div class="today-example">
            <div class="today-example-en">${ex.en}</div>
            <div class="today-example-cn">${ex.cn}</div>
        </div>`
    ).join('');
    
    let keywordsHTML = content.keywords.map(kw => 
        `<div style="margin: 5px 0;"><strong>${kw.word}</strong> <span style="color: #718096; font-family: monospace;">${kw.phonetic}</span> - ${kw.meaning}</div>`
    ).join('');
    
    return `
        <div class="today-phrase">${content.phrase}</div>
        <div class="today-phonetic">${content.phonetic}</div>
        <div class="today-translation">${content.translation}</div>
        
        <div class="today-section">
            <div class="today-section-title">ğŸ¯ ä½¿ç”¨åœºæ™¯</div>
            <div class="today-section-content">${content.scene}</div>
        </div>
        
        <div class="today-section">
            <div class="today-section-title">ğŸ“ ä¾‹å¥</div>
            <div class="today-section-content">${examplesHTML}</div>
        </div>
        
        <div class="today-section">
            <div class="today-section-title">ğŸ”¤ é‡ç‚¹è¯æ±‡</div>
            <div class="today-section-content">${keywordsHTML}</div>
        </div>
        
        <div class="today-section">
            <div class="today-section-title">ğŸ’¡ çŸ­è¯­è§£è¯»</div>
            <div class="today-section-content">${content.explanation}</div>
        </div>
    `;
}

// åˆå§‹åŒ–æ—¥å†
function initCalendar() {
    renderCalendar();
}

// æ¸²æŸ“æ—¥å†
function renderCalendar() {
    const year = currentCalendarDate.getFullYear();
    const month = currentCalendarDate.getMonth();
    
    document.getElementById('calendar-month').textContent = `${year}å¹´${month + 1}æœˆ`;
    
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const prevLastDay = new Date(year, month, 0);
    
    const firstDayWeek = firstDay.getDay();
    const daysInMonth = lastDay.getDate();
    const daysInPrevMonth = prevLastDay.getDate();
    
    const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
    let html = weekdays.map(w => `<div class="calendar-weekday">${w}</div>`).join('');
    
    // ä¸Šæœˆæ—¥æœŸ
    for (let i = firstDayWeek - 1; i >= 0; i--) {
        const day = daysInPrevMonth - i;
        html += `<div class="calendar-day other-month"><span class="calendar-day-number">${day}</span></div>`;
    }
    
    // å½“æœˆæ—¥æœŸ
    const today = new Date();
    for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const isToday = today.getFullYear() === year && today.getMonth() === month && today.getDate() === day;
        const hasContent = dailyContents[dateStr];
        
        let classes = 'calendar-day';
        if (isToday) classes += ' today';
        if (hasContent) classes += ' has-content';
        
        html += `<div class="${classes}" onclick="showHistory('${dateStr}')">
            <span class="calendar-day-number">${day}</span>
            ${hasContent ? '<span class="calendar-day-indicator"></span>' : ''}
        </div>`;
    }
    
    // ä¸‹æœˆæ—¥æœŸ
    const totalCells = Math.ceil((firstDayWeek + daysInMonth) / 7) * 7;
    const nextMonthDays = totalCells - (firstDayWeek + daysInMonth);
    for (let day = 1; day <= nextMonthDays; day++) {
        html += `<div class="calendar-day other-month"><span class="calendar-day-number">${day}</span></div>`;
    }
    
    document.getElementById('calendar-grid').innerHTML = html;
}

// åˆ‡æ¢æœˆä»½
function changeMonth(delta) {
    currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
    renderCalendar();
}

// æ˜¾ç¤ºå†å²å†…å®¹
function showHistory(dateStr) {
    const content = dailyContents[dateStr];
    if (!content) {
        const date = new Date(dateStr);
        document.getElementById('history-date').textContent = dateStr;
        document.getElementById('history-body').innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“­</div>
                <div>è¿™ä¸€å¤©æ²¡æœ‰å­¦ä¹ å†…å®¹</div>
            </div>
        `;
    } else {
        document.getElementById('history-date').textContent = dateStr;
        document.getElementById('history-body').innerHTML = generateTodayHTML(content);
    }
    document.getElementById('history-modal').classList.add('active');
}

// å…³é—­å†å²å¼¹çª—
function closeHistory(event) {
    if (!event || event.target.id === 'history-modal' || event.target.className === 'history-close') {
        document.getElementById('history-modal').classList.remove('active');
    }
}

// åˆ‡æ¢æ ‡ç­¾é¡µ
function showSection(section) {
    // éšè—æ‰€æœ‰éƒ¨åˆ†
    document.getElementById('today-section').classList.add('hidden');
    document.getElementById('calendar-section').classList.add('hidden');
    document.getElementById('learn-section').classList.add('hidden');
    document.getElementById('quiz-section').classList.add('hidden');
    document.getElementById('list-section').classList.add('hidden');
    document.getElementById('stats-section').classList.add('hidden');
    
    // ç§»é™¤æ‰€æœ‰activeç±»
    document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
    
    // æ˜¾ç¤ºé€‰ä¸­çš„éƒ¨åˆ†
    document.getElementById(section + '-section').classList.remove('hidden');
    
    // æ‰¾åˆ°å¯¹åº”çš„tabå¹¶è®¾ä¸ºactive
    const tabs = document.querySelectorAll('.nav-tab');
    const sectionNames = ['today', 'calendar', 'learn', 'quiz', 'list', 'stats'];
    const tabIndex = sectionNames.indexOf(section);
    if (tabIndex >= 0) {
        tabs[tabIndex].classList.add('active');
    }
    
    if (section === 'list') {
        loadPhraseList();
    } else if (section === 'stats') {
        updateStats();
    }
}

// åŠ è½½ç±»åˆ«
function loadCategory() {
    currentCategory = document.getElementById('category-select').value;
    currentIndex = 0;
    displayPhrase();
}

// æ˜¾ç¤ºå½“å‰çŸ­è¯­
function displayPhrase() {
    const category = phrases[currentCategory];
    const phrase = category[currentIndex];
    
    document.getElementById('current-phrase').textContent = phrase.en;
    document.getElementById('current-translation').textContent = phrase.cn;
    document.getElementById('current-index').textContent = currentIndex + 1;
    document.getElementById('total-count').textContent = category.length;
    document.getElementById('progress-fill').style.width = 
        ((currentIndex + 1) / category.length * 100) + '%';
}

// æœ—è¯»çŸ­è¯­
function speakPhrase() {
    const phrase = document.getElementById('current-phrase').textContent;
    const utterance = new SpeechSynthesisUtterance(phrase);
    utterance.lang = 'en-US';
    utterance.rate = 0.8;
    speechSynthesis.speak(utterance);
}

// æœ—è¯»æŒ‡å®šæ–‡æœ¬
function speak(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 0.8;
    speechSynthesis.speak(utterance);
}

// æ ‡è®°å·²å­¦ä¼š
function markLearned() {
    const phrase = phrases[currentCategory][currentIndex];
    const phraseId = currentCategory + '-' + currentIndex;
    
    if (!learnedPhrases.includes(phraseId)) {
        learnedPhrases.push(phraseId);
        localStorage.setItem('learnedPhrases', JSON.stringify(learnedPhrases));
    }
    
    // è‡ªåŠ¨ä¸‹ä¸€ä¸ª
    nextPhrase();
}

// ä¸‹ä¸€ä¸ªçŸ­è¯­
function nextPhrase() {
    const category = phrases[currentCategory];
    currentIndex = (currentIndex + 1) % category.length;
    displayPhrase();
}

// åŠ è½½çŸ­è¯­åˆ—è¡¨
function loadPhraseList() {
    const listCategory = document.getElementById('list-category-select').value;
    const container = document.getElementById('phrases-list');
    container.innerHTML = '';
    
    const categories = listCategory === 'all' ? Object.keys(phrases) : [listCategory];
    
    categories.forEach(cat => {
        phrases[cat].forEach((phrase, idx) => {
            const phraseId = cat + '-' + idx;
            const isLearned = learnedPhrases.includes(phraseId);
            
            const item = document.createElement('div');
            item.className = 'phrase-item' + (isLearned ? ' learned' : '');
            item.innerHTML = `
                <div class="phrase-item-content">
                    <div class="phrase-item-en">${phrase.en}</div>
                    <div class="phrase-item-cn">${phrase.cn}</div>
                </div>
                <div class="phrase-item-actions">
                    <button class="icon-btn speak" onclick="speak('${phrase.en.replace(/'/g, "\\'")}')">ğŸ”Š</button>
                    <button class="icon-btn check ${isLearned ? 'checked' : ''}" onclick="toggleLearned('${phraseId}', this)">${isLearned ? 'âœ“' : 'â—‹'}</button>
                </div>
            `;
            container.appendChild(item);
        });
    });
}

// åˆ‡æ¢å­¦ä¹ çŠ¶æ€
function toggleLearned(phraseId, btn) {
    if (learnedPhrases.includes(phraseId)) {
        learnedPhrases = learnedPhrases.filter(id => id !== phraseId);
        btn.classList.remove('checked');
        btn.textContent = 'â—‹';
    } else {
        learnedPhrases.push(phraseId);
        btn.classList.add('checked');
        btn.textContent = 'âœ“';
    }
    localStorage.setItem('learnedPhrases', JSON.stringify(learnedPhrases));
    loadPhraseList();
}

// æ›´æ–°ç»Ÿè®¡
function updateStats() {
    let totalPhrases = 0;
    Object.values(phrases).forEach(cat => totalPhrases += cat.length);
    
    document.getElementById('stat-total').textContent = totalPhrases;
    document.getElementById('stat-learned').textContent = learnedPhrases.length;
    document.getElementById('stat-quiz').textContent = quizStats.total;
    
    const progress = Math.round(learnedPhrases.length / totalPhrases * 100);
    document.getElementById('stat-progress').textContent = progress + '%';
    document.getElementById('stats-progress-fill').style.width = progress + '%';
    document.getElementById('stats-percent').textContent = progress + '%';
}

// æµ‹è¯•æ¨¡å¼
let currentQuiz = null;

function startQuiz() {
    // è·å–æ‰€æœ‰çŸ­è¯­
    let allPhrases = [];
    Object.keys(phrases).forEach(cat => {
        phrases[cat].forEach((p, i) => {
            allPhrases.push({...p, id: cat + '-' + i});
        });
    });
    
    // éšæœºé€‰æ‹©10ä¸ª
    allPhrases = allPhrases.sort(() => 0.5 - Math.random()).slice(0, 10);
    
    currentQuiz = {
        phrases: allPhrases,
        current: 0,
        correct: 0
    };
    
    document.getElementById('quiz-start-btn').classList.add('hidden');
    showQuizQuestion();
}

function showQuizQuestion() {
    if (currentQuiz.current >= currentQuiz.phrases.length) {
        // æµ‹è¯•ç»“æŸ
        const accuracy = Math.round(currentQuiz.correct / currentQuiz.phrases.length * 100);
        document.getElementById('quiz-question').innerHTML = `
            <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ‰</div>
            æµ‹è¯•å®Œæˆï¼<br>
            æ­£ç¡®ç‡ï¼š${currentQuiz.correct}/${currentQuiz.phrases.length} (${accuracy}%)
        `;
        document.getElementById('quiz-options').innerHTML = '';
        document.getElementById('quiz-start-btn').textContent = 'å†æµ‹ä¸€æ¬¡';
        document.getElementById('quiz-start-btn').classList.remove('hidden');
        
        // æ›´æ–°ç»Ÿè®¡
        quizStats.total++;
        localStorage.setItem('quizStats', JSON.stringify(quizStats));
        return;
    }
    
    const phrase = currentQuiz.phrases[currentQuiz.current];
    document.getElementById('quiz-question').innerHTML = `
        <div style="font-size: 0.9rem; color: #718096; margin-bottom: 10px;">
            é—®é¢˜ ${currentQuiz.current + 1} / ${currentQuiz.phrases.length}
        </div>
        "${phrase.cn}"
    `;
    
    // ç”Ÿæˆé€‰é¡¹ï¼ˆæ­£ç¡®ç­”æ¡ˆ + 3ä¸ªéšæœºé”™è¯¯ç­”æ¡ˆï¼‰
    const options = [phrase];
    let allOtherPhrases = [];
    Object.keys(phrases).forEach(cat => {
        phrases[cat].forEach(p => {
            if (p.en !== phrase.en) allOtherPhrases.push(p);
        });
    });
    allOtherPhrases = allOtherPhrases.sort(() => 0.5 - Math.random()).slice(0, 3);
    options.push(...allOtherPhrases);
    options.sort(() => 0.5 - Math.random());
    
    const optionsContainer = document.getElementById('quiz-options');
    optionsContainer.innerHTML = '';
    
    options.forEach(opt => {
        const btn = document.createElement('div');
        btn.className = 'quiz-option';
        btn.textContent = opt.en;
        btn.onclick = () => checkAnswer(opt, phrase, btn);
        optionsContainer.appendChild(btn);
    });
}

function checkAnswer(selected, correct, btn) {
    const options = document.querySelectorAll('.quiz-option');
    options.forEach(opt => opt.style.pointerEvents = 'none');
    
    if (selected.en === correct.en) {
        btn.classList.add('correct');
        currentQuiz.correct++;
    } else {
        btn.classList.add('wrong');
        options.forEach(opt => {
            if (opt.textContent === correct.en) {
                opt.classList.add('correct');
            }
        });
    }
    
    setTimeout(() => {
        currentQuiz.current++;
        showQuizQuestion();
    }, 1500);
}

// åˆå§‹åŒ–
init();
    </script>
</body>
</html>
